<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Гостенайзер</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

<!--multiselect-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
    <script type="text/javascript" th:src="@{/js/ajax.js}"></script>
    <link th:href="@{/css/styles.css}" rel="stylesheet"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js'></script>

</head>
<body style="background-image: url('/back.jpg');">
<div class="container">

    <div th:if="${errorMessage != null}" th:text="${errorMessage}" class="row text-center alert alert-danger">
    </div>
    <h4 class="text-center spacer">Тут должен быть график</h4>
    <div class = "row">

    <div class="col-3">
        <form id="form1" method="post" th:action="@{/graph}" th:object="${payload}">
            <select class="selectpicker" data-live-search="true" th:field="*{filters}" multiple="multiple">

            <option th:each="dropDownItem : ${filters}"
                    th:value="${dropDownItem.getName()}"
                    th:text="${dropDownItem.getName()}" />
            </select>
        <input type="submit"  value="Create User">
        </form>
    </div>

    </div>

    <div class="row" style="background-color: rgb(250,250,250);">
        <canvas id="histogram"></canvas>
    </div>
</div>

<script>

  $("#form1").submit(function(e) {

        //prevent Default functionality
        e.preventDefault();

        //get the action-url of the form
        var actionurl = e.currentTarget.action;

        loadGraph(actionurl);

    });
function loadGraph(url){
    jQuery.ajaxSetup({async:false});
    axisArrays = null;
    $.get(url, {text: 'Текст'}, function(data){
        axisArrays = data;
    });
    console.log(axisArrays);

	xArray = axisArrays.xarray;
	yArray = axisArrays.yarray
console.log(xArray);

        const ctx = document.getElementById('histogram').getContext('2d');

const chart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: xArray,
    datasets: [{
      label: 'Number of Arrivals',
      data: yArray,
      backgroundColor: 'blue',
    }]
  },
  options: {
    scales: {
      xAxes: [{
        display: false,
        barPercentage: 1.3,
        ticks: {
          max: 3,
        }
      }, {
        display: true,
        ticks: {
          autoSkip: false,
          max: 4,
        }
      }],
      yAxes: [{
        ticks: {
          beginAtZero: true
        }
      }]
    }
  }
});
};
    </script>


</body>
</html>